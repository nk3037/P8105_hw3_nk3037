---
title: "P8105_hw3_nk3037"
author: "Navya Koneripalli"
date: "2023-10-11"
output: github_document
---
## Setup
```{r setup, include=FALSE}
library(tidyverse)
library(p8105.datasets)
library (ggplot2)
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 12, 
  fig.height = 8,
  out.width = "90%"
)
theme_set(theme_minimal() + theme(legend.position = "bottom"))
```

## Question 1
```{r}
data("instacart")

instacart = 
  instacart |> 
  as_tibble()
frequency_table <- table(instacart$product_name)

most_ordered_item <- names(frequency_table)[which.max(frequency_table)]
# Created a variable to store the most ordered item
```
The dataset has `r nrow(instacart)` rows and `r ncol(instacart)` columns. Each row in the dataset represents a product in an order. Besides having columns that identify orders and products, the dataset has columns that tell us the order that the product was added to cart, whether it was reordered or not, order time, department and aisle name and id of the product.The dataset contains information for `r instacart %>% select(order_id) %>% distinct() %>% count()` orders from `r instacart %>% select(department) %>% distinct() %>% count()` departments. The most ordered item is `r most_ordered_item`.

This table below shows the number of aisles and the most commonly ordered items:
```{r}
instacart |> 
  count(aisle) |> 
  arrange(desc(n))
```

The plot below shows the number of items ordered in each aisle
```{r}
instacart %>% 
  count(aisle) %>%
  filter (aisle > 10000) %>% 
  mutate(aisle = fct_reorder(aisle, n)) %>% 
  ggplot(aes(x = aisle, y = n)) + 
  geom_point() +
  labs(title = "Number of items ordered in each aisle") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))
```

The table shows the three most popular items in each of the aisles “baking ingredients”, “dog food care”, and “packaged vegetables fruits” and include the number of times each item is ordered.
```{r}
instacart %>% 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>% 
  group_by(aisle) %>%  
  count(product_name) %>% 
  mutate(rank = min_rank(desc(n))) %>% 
  filter(rank < 4) %>% 
  arrange(desc(n)) %>% 
  knitr::kable()
```

The table shows the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week 
```{r, message=FALSE}
instacart %>% 
  filter(product_name %in% c("Coffee Ice Cream","Pink Lady Apples")) %>% 
  group_by(product_name, order_dow) %>%
  summarize(avg_tod = mean(order_hour_of_day)) %>% 
  pivot_wider(
    names_from = order_dow,
    values_from = avg_tod) %>% 
  knitr::kable()
```

## Question 2
### Setup and Data Cleaning
```{r}
library(p8105.datasets)
data("brfss_smart2010")

brfss_smart2010 = janitor::clean_names(brfss_smart2010, case = "snake") #convert all variable names into snake_case

brfss_smart2010 = brfss_smart2010 %>% 
  rename(state = locationabbr) %>% 
  rename(county = locationdesc)
# renamed Locationabbr to state and Locationdesc to county.

brfss_smart2010 <- brfss_smart2010 %>% 
  filter(topic == "Overall Health") %>% 
  filter(response %in% c("Excellent", "Very good", "Good", "Fair", "Poor")) %>% 
  arrange(factor(response, levels = c("Poor", "Fair good", "Good", "Very good", "Excellent")))
# Filtered to keep only overall health topic, and those with Poor to Excellent responses and arranged the responses from Poor to Excellent
```

This tells us in 2002, which states were observed at 7 or more locations
```{r}
brfss_filtered_2002 = brfss_smart2010 %>% 
  filter(year == 2002) %>% 
  group_by(state) %>%
  summarise(count = n_distinct(county)) %>% 
  filter (count >= 7)
```

In 2002, `r nrow(brfss_filtered_2002)` states were observed at 7 or more counties. The states are **CT, FL, MA, NC, NJ, PA**

This tells us in 2010, which states were observed at 7 or more locations
```{r}
brfss_filtered_2010 = brfss_smart2010 %>% 
  filter(year == 2010) %>% 
  group_by(state) %>%
  summarise(count = n_distinct(county)) %>% 
  filter (count >= 7)
```

In 2002, `r nrow(brfss_filtered_2010)` states were observed at 7 or more counties. The states are: **CA, CO, FL, MA, MD, NC, NE, NJ, NY, OH, PA, SC, TX, WA**.